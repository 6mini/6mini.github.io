---
title: '[Project] Landing Delay Prediction Machine Learning Model'
description: ì½”ë“œìŠ¤í…Œì´ì¸  Section2 ë‘ë²ˆì§¸ í”„ë¡œì íŠ¸ 'í•­ê³µê¸° ì°©ë¥™ ì§€ì—° ì˜ˆì¸¡ ë¨¸ì‹ ëŸ¬ë‹ ëª¨ë¸ë§'ì´ë¼ëŠ” ì£¼ì œë¡œ ì§„í–‰í•œ ë°ì´í„° ë¶„ì„, ì „ì²˜ë¦¬ ê³¼ì • ë° ì‹œê°í™”ë¥¼ í†µí•œ ë¶„ì„, ë¨¸ì‹ ëŸ¬ë‹ ëª¨ë¸ë§ ë° í•´ì„
categories:
 - Project
tags: [Project, Python, EDA, Visualization]
# 0ï¸âƒ£1ï¸âƒ£2ï¸âƒ£3ï¸âƒ£4ï¸âƒ£5ï¸âƒ£6ï¸âƒ£7ï¸âƒ£8ï¸âƒ£9ï¸âƒ£ğŸ”Ÿ
---
# 1ï¸âƒ£ Porject ê°œìš”
- ì§ì ‘ ì„ íƒí•œ ë°ì´í„°ì…‹ì„ ì‚¬ìš©í•´ì„œ ë§Œë“  ë¨¸ì‹ ëŸ¬ë‹ ì˜ˆì¸¡ ëª¨ë¸ì„ í†µí•œ ì„±ëŠ¥ ë° ì¸ì‚¬ì´íŠ¸ë¥¼ ë„ì¶œ/ê³µìœ í•˜ëŠ” ê²ƒì´ ëª©í‘œ
- ë°ì´í„°ì…‹ ì „ì²˜ë¦¬/EDAë¶€í„° ëª¨ë¸ì„ í•´ì„í•˜ëŠ” ê³¼ì •ì„ colabì„ ì‚¬ìš©í•˜ì—¬ ì‘ì„±í•˜ê³ , í•´ë‹¹ ë‚´ìš©ì„ ê¸°ë°˜ìœ¼ë¡œ ì„¤ëª…í•˜ëŠ” ì˜ìƒì„ ì‘ì„±
- ë°œí‘œë¥¼ ë“£ëŠ” ì‚¬ëŒì€ **ë¹„ë°ì´í„° ì§êµ°**

## ì ˆì°¨
1. ë°ì´í„° ì„ ì • ì´ìœ  ë° ë¬¸ì œ ì •ì˜
  - í•´ë‹¹ ë°ì´í„°ë¥¼ ì„ íƒí•œ ì´ìœ 
  - ì–´ë–¤ ìœ í˜•ì˜ ë¬¸ì œë¡œ ì ‘ê·¼
2. ë°ì´í„°ë¥¼ ì´ìš©í•œ ê°€ì„¤ ë° í‰ê°€ì§€í‘œ, ë² ì´ìŠ¤ë¼ì¸ ì„ íƒ
  - ë°ì´í„°ë¥¼ í†µí•´ì„œ ë¬´ì—‡ì„ í•´ë³¼ ìˆ˜ ìˆì„ì§€ ê°€ì„¤ì„ ì„¸ìš´ë‹¤.(ê°€ì„¤ì€ ì“¸ëª¨ ìˆì–´ì•¼ í•¨)
  - í•´ë‹¹ íŠ¹ì„±ì„ targetìœ¼ë¡œ ì§€ì •í•œ ì´ìœ 
  - í•´ë‹¹ ë² ì´ìŠ¤ë¼ì¸ ëª¨ë¸ê³¼ í‰ê°€ì§€í‘œë¥¼ ì„ íƒí•œ ì´ìœ 
3. EDAì™€ ë°ì´í„° ì „ì²˜ë¦¬
  - EDA
  - Feature Engineering
  - ë°ì´í„° ì •ê·œí™”
  - ë…¸ì´ì¦ˆ ì œê±°
  - ê²°ì¸¡ì¹˜ ì œê±° í˜¹ì€ ëŒ€ì²´
  - ë°ì´í„° ë°¸ëŸ°ìŠ¤
  - ê·¸ ì™¸
  - ë‹¤ìŒ ì§ˆë¬¸ì— ëŒ€ë‹µ
>Data Leakage ì—¬ë¶€, ë°©ì§€í•œ ë°©ë²•<br>
>ë§Œë“¤ê³ ì í•˜ëŠ” ëª¨ë¸ì˜ ìœ ìš©ì„±, í•œê³„
4. ë¨¸ì‹ ëŸ¬ë‹ ë°©ì‹ ì ìš© ë° êµì°¨ê²€ì¦
  - Tree-Based / Ensemble ëª¨ë¸ í•™ìŠµ(ë‹¤ì–‘í•˜ê²Œ ì‹œë„)
  - í‰ê°€ì§€í‘œ ê³„ì‚° í›„ ë² ì´ìŠ¤ë¼ì¸ê³¼ ë¹„êµ
  - êµì°¨ê²€ì¦ì„ í†µí•´ ì¼ë°˜í™”ë  ê°€ëŠ¥ì„± í™•ì¸
  - ëª¨ë¸ ì„±ëŠ¥ ê°œì„ í•˜ê¸° ìœ„í•œ ë‹¤ì–‘í•œ ë°©ë²• ì ìš©
  - ìµœì†Œ 2ê°œ ì´ìƒì˜ ëª¨ë¸ì„ ë§Œë“¤ì–´ validation ì ìˆ˜ ë³´ê³ 
  - ìµœì¢… ëª¨ë¸ì˜ test ì ìˆ˜ ë³´ê³ 
  - ë‹¤ìŒ ì§ˆë¬¸ì— ëŒ€ë‹µ
>ë² ì´ìŠ¤ë¼ì¸ë³´ë‹¤ ì˜ ë‚˜ì™”ëŠ”ì§€, ê·¸ë ‡ì§€ ì•Šë‹¤ë©´ ê·¸ ì´ìœ ëŠ” ë¬´ì—‡ì¼ì§€<br>
>ëª¨ë¸ ì„±ëŠ¥ ê°œì„ ì„ ìœ„í•´ ì–´ë–¤ ë°©ë²•ì„ ì ìš©í•œì§€, ê·¸ ë°©ë²•ì„ ì„ íƒí•œ ì´ìœ ëŠ” ë¬´ì—‡ì¼ì§€<br>
>ìµœì¢…ëª¨ë¸ì— ê´€í•œ ì„¤ëª…
5. ë¨¸ì‹ ëŸ¬ë‹ ëª¨ë¸ í•´ì„
  - PDP, SHAP í™œìš© ë¹„ì „ë¬¸ê°€ë¼ë„ ì¡°ê¸ˆ ë” ì‰½ê²Œ ì´í•´í•˜ê³  ì ‘ê·¼í•  ìˆ˜ ìˆë„ë¡ ìµœì¢…ëª¨ë¸ ì„¤ëª…
  - ë‹¤ìŒ ì§ˆë¬¸ì— ëŒ€ë‹µ
>ëª¨ë¸ì´ ê´€ì¸¡ì¹˜ë¥¼ ì˜ˆì¸¡í•˜ê¸° ìœ„í•´ ì–´ë–¤ íŠ¹ì„±ì„ í™œìš©í–ˆëŠ”ì§€<br>
>ì–´ë–¤ íŠ¹ì„±ì´ ìˆë‹¤ë©´ ëª¨ë¸ì˜ ì˜ˆì¸¡ì— ë„ì›€ë  ì§€, í•´ë‹¹ íŠ¹ì„±ì€ ì–´ë–»ê²Œ êµ¬í•  ìˆ˜ ìˆì„ì§€

## ê³„íš
1. ì „ì²´ì ì¸ ëª¨ë¸ë§
2. ipynb ì •ë¦¬
3. Keynote ì‘ì„±
4. ëŒ€ë³¸ ì‘ì„±
5. ì´¬ì˜

# 2ï¸âƒ£ Landing Delay Prediction Machine Learning Model
- í•­ê³µêµí†µ ìˆ˜ìš”ê°€ ì§€ì†ì ìœ¼ë¡œ ì¦ê°€í•¨ì— ë”°ë¼ í•­ê³µê¸° ì§€ì—°ìœ¼ë¡œ ì¸í•œ ì´ìš©ìë“¤ì˜ ë¶ˆí¸ê³¼ í”¼í•´ê°€ ëŠ˜ì–´ë‚˜ê³  ìˆë‹¤.
- ì§€ì—° ë°œìƒ ì‹œ ê³µí•­, í•­ê³µì‚¬, í•­ê³µêµí†µì´ìš©ì ëª¨ë‘ì—ê²Œ ì‹œê°„ì Â·ê¸ˆì „ì  ì†í•´ê°€ ë°œìƒí•˜ë©° ê³µí•­ ìš´ì˜ì— ìˆì–´ ìƒë‹¹í•œ í”¼í•´ë¥¼ ì…ê²Œ ëœë‹¤.
- ì§€ì—° ë°œìƒì„ ì˜ˆì¸¡í•  ìˆ˜ ìˆë‹¤ë©´ ê³µí•­ ë° í•­ê³µì‚¬ ê´€ê³„ìê°€ ì‚¬ì „ì— ê³µí•­ìš´ì˜ì— ëŒ€í•œ ì ì ˆí•œ ì¡°ì¹˜ë¥¼ ì·¨í•  ìˆ˜ ìˆì–´ ì†Œë¹„ìê°€ ì…ì„ ì¶”ê°€ì ì¸ í”¼í•´ì— ëŒ€ë¹„í•  ìˆ˜ ìˆë‹¤.
- ë‹¤ì–‘í•œ ì‚¬ìœ ë¥¼ í†µí•´ ì •ìƒì°©ë¥™, ì§€ì—°ìœ¼ë¡œì˜ ë¶„ë¥˜ ë¬¸ì œë¡œ ì˜ˆì¸¡í•˜ê³ ì í•œë‹¤.
- ì´ë¥¼ í†µí•˜ì—¬ ì†Œë¹„ìì˜ í¸ìµì´ ì¦ì§„ë  ë¿ ì•„ë‹ˆë¼, í•­ê³µì‚¬ì™€ ê³µí•­ì˜ íš¨ìœ¨ì„±ê³¼ ë¹„ìš©ì ˆê°ì—ë„ ê¸°ì—¬í•  ìˆ˜ ìˆì„ ê²ƒìœ¼ë¡œ ê¸°ëŒ€í•œë‹¤.

# 3ï¸âƒ£ Data Collection 
- í•´ê²°í•˜ê³ ì í•˜ëŠ” ë¬¸ì œ : í•­ê³µê¸° ì°©ë¥™ ì§€ì—° ì˜ˆì¸¡
- ë‹µì„ ì–»ê¸° ìœ„í•œ ë°ì´í„° : ìºê¸€ì˜ '2015 Flight Delays and Cancellations' ë°ì´í„°
- ì„ ì •ì´ìœ 
  - í•­ê³µ ìŠ¹ë¬´ì›ì´ì—ˆë˜ ê²½ë ¥ì„ ì‚´ë ¤ ê¹Šê²Œ íŒŒê³ ë“¤ ìˆ˜ ìˆëŠ” ë„ë©”ì¸ì´ê¸°ì— ê³¨ëë‹¤.
  - ì‚¬ìš©í•  íƒ€ê²Ÿ íŠ¹ì„±ì€ resultìœ¼ë¡œ 15ë¶„ ì´ìƒ ì§€ì—°ë˜ì—ˆëŠ”ì§€ë¥¼ í™•ì¸í•  ìˆ˜ ìˆëŠ” binaryê°’ì´ë‹¤.
  - ì „ì²´ ë°ì´í„°ë¡œ ì‹¤í—˜í•´ë³´ê³  ì‹¶ì§€ë§Œ, Costì˜ í•œê³„ë¡œ 1ì›”ì˜ Small Dataë¡œ ì§„í–‰í•´ë³´ê³ ì í•œë‹¤.
  - í’€ê³ ì í•˜ëŠ” ë¬¸ì œëŠ” ë¶„ë¥˜ë¬¸ì œì´ë©° ì—¬ëŸ¬ê°€ì§€ ìƒí™©ì— ë”°ë¼ í•­ê³µê¸° ì°©ë¥™ì´ ì§€ì—°ë ì§€, ì§€ì—°ë˜ì§€ ì•Šì„ì§€ë¥¼ ì˜ˆì¸¡í•˜ëŠ” ëª¨ë¸ë§ì„ í•  ê²ƒì´ë‹¤.
  - ë°ì´í„°ì—ì„œ ë„ì°©ê³¼ ê´€ë ¨ëœ ì •ë³´ë¥¼ ëª¨ë‘ ì œê±°í•˜ì—¬ í•­ê³µê¸°ê°€ Take-offí•¨ê³¼ ë™ì‹œì— ì§€ì—°ì„ ì—ì¸¡í•˜ëŠ” ëª¨ë¸ë§ì„ í•  ê²ƒì´ë‹¤.

```py
train = pd.read_csv('/content/drive/MyDrive/flights.csv')
airlines = pd.read_csv('/content/drive/MyDrive/airlines.csv')

# Costì˜ í•œê³„ë¡œ 10ë§Œê°œì˜ dataë¡œ ì§„í–‰
train = train[0:100000]
train
```

![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2021-08-31 20 33 24](https://user-images.githubusercontent.com/79494088/131495416-fd111e1d-7d09-4c66-aa7c-3c734f2fa939.png)

```py
# ì»¬ëŸ¼ í™•ì¸
train.columns
'''
Index(['YEAR', 'MONTH', 'DAY', 'DAY_OF_WEEK', 'AIRLINE', 'FLIGHT_NUMBER',
       'TAIL_NUMBER', 'ORIGIN_AIRPORT', 'DESTINATION_AIRPORT',
       'SCHEDULED_DEPARTURE', 'DEPARTURE_TIME', 'DEPARTURE_DELAY', 'TAXI_OUT',
       'WHEELS_OFF', 'SCHEDULED_TIME', 'ELAPSED_TIME', 'AIR_TIME', 'DISTANCE',
       'WHEELS_ON', 'TAXI_IN', 'SCHEDULED_ARRIVAL', 'ARRIVAL_TIME',
       'ARRIVAL_DELAY', 'DIVERTED', 'CANCELLED', 'CANCELLATION_REASON',
       'AIR_SYSTEM_DELAY', 'SECURITY_DELAY', 'AIRLINE_DELAY',
       'LATE_AIRCRAFT_DELAY', 'WEATHER_DELAY'],
      dtype='object')

ã…ë°ì´í„° ì»¬ëŸ¼ ì„¤ëª…
    YEAR                        
    MONTH                       
    DAY                         
    DAY_OF_WEEK                 
    AIRLINE                     í•­ê³µì‚¬
    FLIGHT_NUMBER               í•­ê³µí¸
    TAIL_NUMBER                 í•­ê³µê¸°
    ORIGIN_AIRPORT              ì¶œë°œ ê³µí•­
    DESTINATION_AIRPORT         ëª©ì ì§€ ê³µí•­
    SCHEDULED_DEPARTURE         ì¶œë°œ ì˜ˆì •ì‹œê°„
    DEPARTURE_TIME              ì¶œë°œ ì‹œê°„
    DEPARTURE_DELAY             ì´ ì¶œë°œ ì§€ì—°
    TAXI_OUT                    ê²Œì´íŠ¸ì—ì„œ ì¶œë°œí•  ë•Œê¹Œì§€ì˜ ê²½ê³¼ ì‹œê°„
    WHEELS_OFF                  í•­ê³µê¸°ì˜ ë°”í€´ê°€ ì§€ë©´ì„ ë– ë‚˜ëŠ” ì‹œì 
    SCHEDULED_TIME              ë¹„í–‰ ê³„íš ì‹œê°„
    ELAPSED_TIME                ê²½ê³¼ ì‹œê°„ = AIR_TIME + TAXI_IN + TAXI_OUT
    AIR_TIME                    WHEELS_OFFê³¼ WHEELS_ON ì‚¬ì´ì˜ ì‹œê°„
    DISTANCE                    ë‘ ê³µí•­ ê°„ì˜ ê±°ë¦¬
    WHEELS_ON                   í•­ê³µê¸° ë°”í€´ê°€ ì§€ë©´ì— ë‹¿ëŠ” ì‹œì 
    TAXI_IN                     ëª©ì ì§€ ê³µí•­ì— ê²Œì´íŠ¸ ë„ì°©ê¹Œì§€ ê²½ê³¼ëœ ì‹œê°„
    SCHEDULED_ARRIVAL           ì˜ˆì • ë„ì°© ì‹œê°„
    ARRIVAL_TIME                ë„ì°© ì‹œê°„
    ARRIVAL_DELAY               ì§€ì—° ì‹œê°„
    DIVERTED                    ì§€ì—°
    CANCELLED                   ì·¨ì†Œ
    CANCELLATION_REASON         ì·¨ì†Œ ì‚¬ìœ 
    AIR_SYSTEM_DELAY            ì—ì–´ ì‹œìŠ¤í…œ
    SECURITY_DELAY              ë³´ì•ˆ
    AIRLINE_DELAY               í•­ê³µì‚¬
    LATE_AIRCRAFT_DELAY         í•­ê³µê¸°
    WEATHER_DELAY               ë‚ ì”¨
'''
```

# 4ï¸âƒ£ ê°€ì„¤ ë° í‰ê°€ì§€í‘œ, Baseline
  - ê°€ì„¤
    1. ì¶œë°œ ì˜ˆì •ì‹œê°„ë³´ë‹¤ ì¶œë°œì— ì§€ì—°ëœ ì‹œê°„ì´ í´ ìˆ˜ë¡ ì°©ë¥™ ì§€ì—° í™•ë¥ ì€ ëŠ˜ì–´ë‚  ê²ƒì´ë‹¤.
    2. ì§€ì—°ì´ ì¦ì€ í•­ê³µì‚¬ê°€ ìˆìœ¼ë¯€ë¡œ ì§€ì—° í™•ë¥ ì„ ì¤„ì´ê¸° ìœ„í•œ ê³ ë ¤ì‚¬í•­ì´ ëœë‹¤.
    3. ê³µí•­ì˜ ë³µì¡ë„ ê³ ë ¤ ì°©ë¥™ì§€ì—°ì´ ì¦ì€ ì¶œë°œ ê³µí•­ì¼ ìˆ˜ë¡ ë„ì°© ê³µí•­ìœ¼ë¡œì„œì˜ ì§€ì—°ë„ ì¦ë‹¤.
  - Target íŠ¹ì„±ìœ¼ë¡œëŠ” 15ë¶„ ì´ìƒ ì§€ì—° ëì„ ì§€ë¥¼ í‘œì‹œí•˜ëŠ” ìƒˆë¡œìš´ columnì„ ìƒì„±í–ˆë‹¤.
  - Baseline Modelë¡œëŠ” ì´ˆê¸° ìµœë¹ˆê°’ ì •í™•ë„ 0.65ì—ì„œ RandomForestì˜ AUC Scoreë¡œ ë³€ê²½í•˜ì˜€ë‹¤.

# 5ï¸âƒ£ EDA

- ì›í•˜ëŠ” ëª¨ë¸ë§ì„ ìœ„í•´ Feature Engineering ë°”ë¡œ ì§„í–‰

```py
def engineering(df):
    # ë„ì°© ì§€ì—°ì„ ì˜ˆì¸¡í•´ì•¼ í•˜ë¯€ë¡œ ë„ì°©ì •ë³´ì— ê´€í•œ ì»¬ëŸ¼ê³¼ í•„ìš”ì—†ëŠ” ì»¬ëŸ¼ì€ ì œê±°í•œë‹¤.
    df = df[['AIRLINE', 'TAIL_NUMBER', 'ORIGIN_AIRPORT', 'DESTINATION_AIRPORT',
        'SCHEDULED_DEPARTURE', 'DEPARTURE_TIME', 'DEPARTURE_DELAY', 'TAXI_OUT',
        'WHEELS_OFF', 'SCHEDULED_TIME', 'DISTANCE',
        'SCHEDULED_ARRIVAL', 'ARRIVAL_DELAY']]
    # 15ë¶„ ì´ìƒ ì§€ì—°ë˜ì—ˆë‹¤ëŠ” ê²ƒì„ í‘œì‹œí•˜ëŠ” ì»¬ëŸ¼ì„ ìƒˆë¡œ ë§Œë“ ë‹¤.
    result=[]

    for row in df['ARRIVAL_DELAY']:
        if row > 15:
            result.append(1)
        else:
            result.append(0)  

    df['result'] = result
    
    # ë¶„ë¥˜ ì»¬ëŸ¼ì„ ë§Œë“¤ì—ˆìœ¼ë‹ˆ ì˜ˆì¸¡ì„ ìœ„í•´ ê¸°ì¡´ ì»¬ëŸ¼ ì‚­ì œ
    df = df.drop(['ARRIVAL_DELAY'], axis = 1)

    # ê²°ì¸¡ì¹˜ ì œê±°
    df = df.dropna()
    return df

train = engineering(train)



# ê²°ì¸¡ì¹˜ í™•ì¸
train.isnull().sum()
'''
AIRLINE                   0
TAIL_NUMBER             167
ORIGIN_AIRPORT            0
DESTINATION_AIRPORT       0
SCHEDULED_DEPARTURE       0
DEPARTURE_TIME         2298
DEPARTURE_DELAY        2298
TAXI_OUT               2371
WHEELS_OFF             2371
SCHEDULED_TIME            0
DISTANCE                  0
SCHEDULED_ARRIVAL         0
result                    0
dtype: int64
'''
```

- í˜„ì¬ë„ ì„ì˜ë¡œ 10ë§Œê°œë¡œ ì¤„ì—¬ì„œ ë°ì´í„°ë¥¼ ì‚¬ìš©ì¤‘ì´ê¸° ë•Œë¬¸ì— 3% ë¹„ìœ¨ë§Œ ì°¨ì§€í•˜ê¸°ë„ í•˜ê³ , ì •í™•í•œ ëª¨ë¸ë§ì„ ìœ„í•´ì„œ ê²°ì¸¡ì¹˜ëŠ” ëª¨ë‘ ì œê±°í•œë‹¤. 

```py
train.dtypes
'''
AIRLINE                 object
TAIL_NUMBER             object
ORIGIN_AIRPORT          object
DESTINATION_AIRPORT     object
SCHEDULED_DEPARTURE      int64
DEPARTURE_TIME         float64
DEPARTURE_DELAY        float64
TAXI_OUT               float64
WHEELS_OFF             float64
SCHEDULED_TIME         float64
DISTANCE                 int64
SCHEDULED_ARRIVAL        int64
result                   int64
dtype: object
'''


# objectì— ëŒ€í•´ë²”ì£¼ í™•ì¸
unicol = ['AIRLINE', 'TAIL_NUMBER', 'ORIGIN_AIRPORT', 'DESTINATION_AIRPORT']
for i in unicol:
    print(i, train[i].unique())
'''
AIRLINE ['AS' 'AA' 'US' 'DL' 'NK' 'UA' 'HA' 'B6' 'OO' 'EV' 'F9' 'WN' 'MQ' 'VX']
TAIL_NUMBER ['N407AS' 'N3KUAA' 'N171US' ... 'N29907' 'N66051' 'N808NW']
ORIGIN_AIRPORT ['ANC' 'LAX' 'SFO' 'SEA' 'LAS' 'DEN' 'SLC' 'PDX' 'FAI' 'MSP' 'PHX' 'SJU'
 'PBG' 'IAG' 'PSE' 'BQN' 'ORD' 'GEG' 'HNL' 'ONT' 'MCO' 'BOS' 'HIB' 'ABR'
 'DFW' 'MKE' 'IAH' 'BNA' 'BRO' 'VPS' 'BOI' 'BJI' 'PHL' 'SBN' 'EUG' 'IAD'
 'BUF' 'PWM' 'JFK' 'CRP' 'PIA' 'FAT' 'SMF' 'AUS' 'MCI' 'ATL' 'JAX' 'MFR'
 'IDA' 'MSN' 'DCA' 'SAT' 'CHS' 'SBA' 'IND' 'CLE' 'GSP' 'BDL' 'RIC' 'BFL'
 'OMA' 'RDM' 'FLL' 'CID' 'TPA' 'SYR' 'ROC' 'TYR' 'LAN' 'GSO' 'EWR' 'PBI'
 'RSW' 'OAK' 'PVD' 'RNO' 'PIT' 'ABQ' 'MIA' 'BWI' 'TUL' 'LGA' 'LIT' 'MSY'
 'OKC' 'ATW' 'PNS' 'MEM' 'TYS' 'MHT' 'SAV' 'CLT' 'GRB' 'ABE' 'JAN' 'OAJ'
 'FAR' 'ERI' 'LEX' 'CWA' 'TTN' 'RDU' 'CVG' 'BHM' 'ACY' 'DTW' 'RAP' 'TUS'
 'EAU' 'DLH' 'FSD' 'INL' 'SPI' 'CLD' 'COD' 'CMH' 'PSC' 'CPR' 'ACV' 'DAL'
 'PAH' 'MRY' 'ESC' 'ISN' 'PSP' 'CAE' 'STL' 'BTV' 'MTJ' 'GCC' 'OGG' 'SJC'
 'GUC' 'ORF' 'MOT' 'MLU' 'KOA' 'HOU' 'MOB' 'SAN' 'LAW' 'PIB' 'MGM' 'SBP'
 'COS' 'LAR' 'DRO' 'BIS' 'ITO' 'BTR' 'HLN' 'BZN' 'MDW' 'MDT' 'SCE' 'LIH'
 'TWF' 'BPT' 'GPT' 'STC' 'HPN' 'MLB' 'PLN' 'CIU' 'CAK' 'DSM' 'BLI' 'SHV'
 'SNA' 'ALB' 'LNK' 'CMI' 'GTF' 'EKO' 'LGB' 'AVL' 'HSV' 'XNA' 'SUX' 'HYS'
 'MFE' 'ISP' 'BUR' 'DAB' 'DAY' 'LFT' 'LBE' 'ASE' 'GUM' 'TVC' 'ALO' 'TLH'
 'ELP' 'MHK' 'IMT' 'JNU' 'JAC' 'MEI' 'DBQ' 'GNV' 'BRD' 'DIK' 'SDF' 'LBB'
 'AVP' 'SGF' 'COU' 'BTM' 'ELM' 'RKS' 'PIH' 'SUN' 'LWS' 'VEL' 'STT' 'SAF'
 'YUM' 'FCA' 'GRR' 'HDN' 'ROA' 'CHA' 'EYW' 'MYR' 'CRW' 'MQT' 'CHO' 'GJT'
 'FWA' 'ECP' 'EVV' 'MSO' 'EGE' 'AMA' 'MLI' 'MBS' 'GFK' 'GRK' 'BIL' 'OTZ'
 'KTN' 'STX' 'ILM' 'PUB' 'RHI' 'CDC' 'HRL' 'SCC' 'FNT' 'LSE' 'MMH' 'ACT'
 'FSM' 'AGS' 'CEC' 'ICT' 'AEX' 'DHN' 'LRD' 'WRG' 'PHF' 'CNY' 'BRW' 'GGG'
 'AZO' 'CLL' 'SRQ' 'ORH' 'FLG' 'TRI' 'VLD' 'SIT' 'BQK' 'BMI' 'PSG' 'FAY'
 'MKG' 'CSG' 'MAF' 'EWN' 'OME' 'CMX' 'JMS' 'SGU' 'RST' 'GTR' 'BET' 'TOL'
 'APN' 'SMX' 'LCH' 'RDD' 'GCK' 'DVL' 'GRI' 'ABY' 'SWF' 'ILG' 'JLN' 'ADK'
 'UST' 'TXK' 'SPS' 'ABI' 'YAK' 'SJT' 'CDV' 'OTH' 'ADQ' 'PPG' 'ROW' 'HOB']
DESTINATION_AIRPORT ['SEA' 'PBI' 'CLT' 'MIA' 'ANC' 'MSP' 'DFW' 'ATL' 'IAH' 'PDX' 'MCI' 'FLL'
 'ORD' 'HNL' 'PHX' 'EWR' 'JFK' 'MCO' 'BOS' 'BDL' 'ITO' 'SFO' 'KOA' 'OGG'
 'MYR' 'DTW' 'LIH' 'DEN' 'SJU' 'LAX' 'BWI' 'IAD' 'BQN' 'BUF' 'LGA' 'HOU'
 'SLC' 'PHL' 'SJC' 'OAK' 'LGB' 'TPA' 'DCA' 'TTN' 'LAS' 'RSW' 'BRD' 'STL'
 'RKS' 'MBS' 'SNA' 'MEI' 'MDW' 'SAN' 'RIC' 'OTZ' 'PIT' 'JAX' 'MSY' 'ONT'
 'PSP' 'BUR' 'DAL' 'CVG' 'SMF' 'RDU' 'BNA' 'AUS' 'DSM' 'BOI' 'ELP' 'TUS'
 'SCC' 'HPN' 'STT' 'MDT' 'RHI' 'SBP' 'MKE' 'JNU' 'CMH' 'CLD' 'KTN' 'CAK'
 'CLE' 'GPT' 'IND' 'SAT' 'SRQ' 'BTV' 'CHS' 'DAY' 'TUL' 'SAV' 'COS' 'GJT'
 'BZN' 'PUB' 'HRL' 'HDN' 'MEM' 'GEG' 'ORH' 'SYR' 'ACY' 'LBB' 'JAC' 'BIL'
 'EUG' 'ASE' 'TVC' 'MTJ' 'OKC' 'PVD' 'HSV' 'CDC' 'GSO' 'YUM' 'ABQ' 'TLH'
 'EGE' 'BTR' 'MOB' 'FWA' 'BIS' 'MFR' 'APN' 'BHM' 'OMA' 'MMH' 'CEC' 'SBA'
 'RNO' 'LAN' 'PNS' 'DLH' 'SDF' 'FAT' 'GRR' 'VPS' 'MFE' 'AVP' 'ROA' 'MRY'
 'LFT' 'AGS' 'MGM' 'ROC' 'LRD' 'ISN' 'MLB' 'ORF' 'ICT' 'ECP' 'CRP' 'AMA'
 'BPT' 'EYW' 'FSD' 'TYS' 'WRG' 'MSN' 'FNT' 'DIK' 'CNY' 'BRW' 'GRB' 'ATW'
 'MKG' 'FLG' 'LEX' 'FCA' 'BTM' 'EVV' 'XNA' 'DRO' 'JMS' 'LNK' 'DBQ' 'FAR'
 'CAE' 'MLI' 'OME' 'GSP' 'GUC' 'SGF' 'LIT' 'MOT' 'RAP' 'ISP' 'PWM' 'GGG'
 'SBN' 'BFL' 'MHT' 'ROW' 'JAN' 'SHV' 'SIT' 'CMX' 'SAF' 'GRK' 'FAY' 'ILM'
 'CMI' 'MAF' 'ALB' 'GTF' 'BMI' 'CID' 'COU' 'GNV' 'SUN' 'SPI' 'PSG' 'AVL'
 'MHK' 'CHA' 'TOL' 'SGU' 'HLN' 'CPR' 'PIH' 'BET' 'VEL' 'RDM' 'HYS' 'PSC'
 'COD' 'INL' 'FAI' 'GCC' 'EKO' 'BJI' 'IDA' 'IMT' 'BRO' 'RST' 'HIB' 'ABR'
 'STC' 'MSO' 'ACV' 'ESC' 'CIU' 'SWF' 'DAB' 'TRI' 'AEX' 'AZO' 'CRW' 'STX'
 'CHO' 'GCK' 'PLN' 'LSE' 'SMX' 'RDD' 'PHF' 'LCH' 'CLL' 'TYR' 'GTR' 'LAR'
 'ERI' 'PAH' 'EAU' 'LBE' 'BLI' 'DVL' 'CWA' 'ILG' 'MLU' 'OAJ' 'ABE' 'ALO'
 'ABY' 'DHN' 'TWF' 'ADK' 'ELM' 'VLD' 'PIB' 'SUX' 'GUM' 'SCE' 'ACT' 'UST'
 'PIA' 'BQK' 'JLN' 'LAW' 'TXK' 'SPS' 'LWS' 'FSM' 'MQT' 'EWN' 'CSG' 'GRI'
 'PBG' 'PSE' 'IAG' 'YAK' 'ABI' 'SJT' 'CDV' 'OTH' 'ADQ' 'PPG' 'HOB' 'GFK']
'''



train.describe().T
```

![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2021-08-31 23 05 38](https://user-images.githubusercontent.com/79494088/131517040-908c9f3a-a253-4597-b08f-9bc1b2d26b76.png)

```py
# ë¶„í¬í™•ì¸
print(train['result'].value_counts(normalize=True))
sns.displot(train['result'],kde=True);
'''
0    0.655758
1    0.344242
Name: result, dtype: float64
'''
```

![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2021-08-31 23 06 40](https://user-images.githubusercontent.com/79494088/131517216-861d97ab-2851-4bf5-97e0-0d04c4bc7ae6.png)

- ì•½ê°„ì€ ë¶ˆê· í˜•í•˜ë‹¤.
- ìµœë¹ˆê°’ì¸ '0.66'ì„ ì´ˆê¸° ì •í™•ë„ Baselineìœ¼ë¡œ ì¡ì•„ë‘”ë‹¤.
- ë‚˜ì¤‘ì— `scale_pos_weight`ë¥¼ ìœ„í•´ ratioë¥¼ ê³„ì‚°í•´ë‘”ë‹¤.
- Hyperparameter tuningë§Œìœ¼ë¡œ ë¶€ì¡±í•˜ë‹¤ë©´ smoteë„ ê³ ë ¤í•´ë‘”ë‹¤.

```py
ratio = 0.345097 / 0.654903
ratio
'''
0.5269436847899612
'''
```

## Visualization

```py
# ìƒê´€ê´€ê³„ ì‹œê°í™”
new = train['result']
train = train.drop(['result'], axis = 1)
train = pd.concat([new, train], axis = 1)
plt.figure(figsize = (15,10))
sns.heatmap(data = train.corr(), annot=True, fmt = '.2f', linewidths=.5, cmap='Blues');
```

![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2021-08-31 23 13 01](https://user-images.githubusercontent.com/79494088/131518320-b55f7ae4-ae8b-4be9-a354-fe4f0daf1844.png)

- í”¼ì³ë“¤ê°„ì˜ ìƒê´€ê´€ê³„ê°€ ë†’ì€ ê²½ìš°ê°€ ì¢…ì¢… ìˆìœ¼ë‚˜, ë¶„ë¥˜ë¬¸ì œì´ê¸° ë•Œë¬¸ì— ë¬´ì‹œí•œë‹¤.

```py
# íŠ¹ì„±ë³„ ë¶„í¬í™•ì¸
delay = train[train.result == 1]
delay.shape
dp = train.columns
for i in dp:
    sns.displot(delay[i],kde=True);
```

![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2021-08-31 23 17 14](https://user-images.githubusercontent.com/79494088/131519127-60caf071-bce2-46f5-8764-4cd6d7ffc1d2.png)

![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2021-08-31 23 17 38](https://user-images.githubusercontent.com/79494088/131519214-0aed4354-0bbe-45af-86ef-1b0b25677202.png)

![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2021-08-31 23 17 54](https://user-images.githubusercontent.com/79494088/131519260-1e9ab647-d841-4a3e-b108-d036f7f39e24.png)

![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2021-08-31 23 18 20](https://user-images.githubusercontent.com/79494088/131519337-bcbe2564-2b53-45b7-85d3-0dd8649760d0.png)

### ê°€ì„¤ 2 : ì§€ì—°ì´ ì¦ì€ í•­ê³µì‚¬ê°€ ìˆìœ¼ë¯€ë¡œ ì§€ì—° í™•ë¥ ì„ ì¤„ì´ê¸° ìœ„í•œ ê³ ë ¤ì‚¬í•­ì´ ëœë‹¤.

```py
# ì§€ì—° ìƒí™©ë§Œ ê°€ì •
delay = train[train.result == 1]
delay.shape

a_del = delay['AIRLINE'].value_counts().reset_index().rename(columns={'index':'IATA_CODE', 'AIRLINE':'count'})
a_del = pd.merge(a_del, airlines, how='left', on='IATA_CODE')

plt.figure(figsize=(10,10))
sns.barplot(x = 'AIRLINE', y = 'count', data = a_del)
plt.xticks(rotation=90)
plt.show()
```

![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2021-08-31 23 37 19](https://user-images.githubusercontent.com/79494088/131522586-a6d3a5f7-9fd8-4244-bb8f-791c01a3ddc4.png)

- ìœ ë… Southwest Airlinesê°€ ë„ì°© ì§€ì—°ì´ ì¦ì€ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.
- ê·¸ë˜í”„ë¡œ ë¯¸ë£¨ì–´ë³´ì•„ ì§€ì—° í™•ë¥ ì„ ì¤„ì´ê¸° ìœ„í•´ì„œ í•­ê³µì‚¬ë¥¼ ì˜ ì„ íƒí•˜ëŠ” ê²ƒë„ ê³ ë ¤ì‚¬í•­ì„ì„ ì•Œ ìˆ˜ ìˆë‹¤.

### ê°€ì„¤ 3 : ê³µí•™ì˜ ë³µì¡ë„ ê³ ë ¤ ì°©ë¥™ì§€ì—°ì´ ì¦ì€ ì¶œë°œ ê³µí•­ì¼ ìˆ˜ë¡ ë„ì°© ê³µí•­ìœ¼ë¡œì„œì˜ ì§€ì—°ë„ ì¦ë‹¤.

```py
oa_del = delay['ORIGIN_AIRPORT'].value_counts().reset_index().rename(columns={'index':'AIRPORT', 'ORIGIN_AIRPORT':'oresult'})
da_del = delay['DESTINATION_AIRPORT'].value_counts().reset_index().rename(columns={'index':'AIRPORT', 'DESTINATION_AIRPORT':'dresult'})
oda_del = pd.merge(oa_del, da_del, how='left', on='AIRPORT')
oda_del = oda_del[:100]

for col in oda_del.columns[1:]:
    plt.figure(figsize=(30,5))
    sns.barplot(x = 'AIRPORT', y = col, data = oda_del)
    plt.xticks(rotation=90)
    plt.show()
```

![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2021-08-31 23 43 19](https://user-images.githubusercontent.com/79494088/131523565-3adb30d8-93f3-4a35-b5bf-2f36ad467c63.png)

- ì¶œë°œê³µí•­ì¼ ë•Œì™€ ë„ì°©ê³µí•­ ì¼ ë•Œì˜ ì§€ì—° íšŸìˆ˜ê°€ ìœ ì˜ë¯¸í•˜ê²Œ ìƒê´€ê´€ê³„ê°€ ìˆìŒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.
- ê·¸ë˜í”„ë¡œ ë¯¸ë£¨ì–´ë³´ì•„ ê³µí•­ì˜ ë³µì¡ë„ ê³ ë ¤ ì°©ë¥™ì§€ì—°ì´ ì¦ì€ ì¶œë°œ ê³µí•­ì¼ ìˆ˜ë¡ ë„ì°© ê³µí•­ìœ¼ë¡œì„œì˜ ì§€ì—°ë„ ì¦ìŒì„ ì•Œ ìˆ˜ ìˆë‹¤.

## ëª¨ë¸ì˜ ìœ ìš©ì„± ë° í•œê³„
- ë§Œë“¤ê³ ì í•˜ëŠ” ëª¨ë¸ì˜ ê²½ìš° í•­ê³µê¸°ì˜ ë°”í€´ê°€ ì§€ë©´ì—ì„œ ë„ì›Œì§€ëŠ” ìˆœê°„ì— ì°©ë¥™ ì§€ì—°ì„ ì˜ˆì¸¡í•  ìˆ˜ ìˆë‹¤.
- ì´ëŠ” ì´ë¥™í•˜ìë§ˆì ì „ ìŠ¹ê°ì—ê²Œ ì°©ë¥™ ì§€ì—° ì—¬ë¶€ë¥¼ ì•Œë ¤ì¤„ ìˆ˜ ìˆê¸° ë•Œë¬¸ì— ìœ ìš©í•  ë¿ ì•„ë‹ˆë¼, ë„ì°© ê³µí•­ì´ë‚˜ í•­ê³µì‚¬ì—ì„œë„ ëŒ€ë¹„ë¥¼ í•  ìˆ˜ ìˆì„ê±°ë¼ ìƒê°í•œë‹¤.
- í•˜ì§€ë§Œ ì´ë¥™ ì‹œ í†µì‹ ì´ ë‘ì ˆë˜ëŠ” í•­ê³µê¸°ì˜ íŠ¹ì„± ìƒ ìŠ¹ê°ì´ ëŒ€ë¹„í•  ìˆ˜ ìˆëŠ” ì—¬ê±´ì€ ë§ˆë ¨ë˜ì§€ ì•ŠëŠ”ë‹¤.

# 6ï¸âƒ£ Modeling

```py
# ë†’ì€ cardinalityë¥¼ ê°€ì§„ columnì— ìœ ìš©í•œ Ordinal ì¸ì½”ë”© ì§„í–‰
encoder = OrdinalEncoder()
train = encoder.fit_transform(train)

# í•™ìŠµ/ê²€ì¦/í…ŒìŠ¤íŠ¸ íƒ€ê²Ÿ ìƒì„± ë° ë¶„ë¦¬
target = 'result'
train, test = train_test_split(train, test_size=0.20, stratify=train[target], random_state=2)
train, val = train_test_split(train, test_size=0.20, stratify=train[target], random_state=2)

# íƒ€ê²Ÿ ì§€ì •
features = train.drop(columns=[target]).columns

X_train = train[features]
y_train = train[target]
X_val = val[features]
y_val = val[target]
X_test = test[features]
y_test = test[target]

X_train.shape, X_val.shape, X_test.shape
'''
((39988, 12), (9997, 12), (12497, 12))
'''
```

## 1ì°¨ Modling(Baseline)

```py
# 1ì°¨ Modeling : RandomForest
model = RandomForestClassifier(n_jobs=-1, random_state=2)

model.fit(X_train, y_train)
y_pred = model.predict(X_val)
print('í›ˆë ¨ ì •í™•ë„', model.score(X_train, y_train))
print('ê²€ì¦ ì •í™•ë„', model.score(X_val, y_val))
print('Report \n',classification_report(y_val, y_pred))
print('f1 ìŠ¤ì½”ì–´',f1_score(y_val, y_pred))
print('aucì ìˆ˜ : ', roc_auc_score(y_val, y_pred))
'''
í›ˆë ¨ ì •í™•ë„ 1.0
ê²€ì¦ ì •í™•ë„ 0.9143743122936882
Report 
               precision    recall  f1-score   support

           0       0.92      0.96      0.94      6556
           1       0.91      0.83      0.87      3441

    accuracy                           0.91      9997
   macro avg       0.91      0.90      0.90      9997
weighted avg       0.91      0.91      0.91      9997

f1 ìŠ¤ì½”ì–´ 0.8700667880995749
aucì ìˆ˜ :  0.8950179563136914
'''
```

- RandomForestë¥¼ ì´ìš©í•˜ì—¬ 1ì°¨ Baseline Modelingì„ ì§„í–‰í–ˆë‹¤.
- Parameterì—†ì´ ê°„ë‹¨íˆ ì§„í–‰í•˜ì˜€ìœ¼ë©°, ì •í™•ë„ë¥¼ ë³´ë©´ ê³¼ì í•©ì´ í™•ì¸ë˜ì§€ë§Œ, ê²€ì¦ Setì—ì„œì˜ ì •í™•ë„ê°€ ìµœë¹ˆê°’ baselineì„ ë„˜ì—ˆìœ¼ë¯€ë¡œ ì´ë²ˆ Modelingì—ì„œ ìœ ì‹¬íˆ ë³¼ í‰ê°€ì§€í‘œì¸ 'AUC Score'ë¥¼ Baselineìœ¼ë¡œ ë‘ê³  ì§„í–‰í•œë‹¤.
- ì •í™•ë„, ì •ë°€ë„ì™€ ì¬í˜„ìœ¨ì´ í¬í•¨ëœ F1ë„ í•¨ê»˜ í™•ì¸í•˜ë©° ì§„í–‰í•˜ì§€ë§Œ ì‹ í˜¸íƒì§€ì´ë¡ ì—ì„œ ì ì¤‘í™•ë¥  ëŒ€ ì˜¤ê²½ë³´í™•ë¥ ì˜ ê·¸ë˜í”„ë¥¼ ì ìˆ˜í™” í•œ AUC Scoreë¥¼ ì¤‘ì ìœ¼ë¡œ ë‘ê³  ì§„í–‰í•œë‹¤.

## 2ì°¨ Modeling

```py
# 2ì°¨ Modeling : CatBoostClassfier
model = CatBoostClassifier()

model.fit(X_train, y_train)
y_pred = model.predict(X_val)
print('í›ˆë ¨ ì •í™•ë„', model.score(X_train, y_train))
print('ê²€ì¦ ì •í™•ë„', model.score(X_val, y_val))
print('Report \n',classification_report(y_val, y_pred))
print('f1 ìŠ¤ì½”ì–´',f1_score(y_val, y_pred))
print('aucì ìˆ˜ : ', roc_auc_score(y_val, y_pred))
'''
Learning rate set to 0.049769
0:	learn: 0.6375374	total: 23.7ms	remaining: 23.7s
1:	learn: 0.5891427	total: 46.3ms	remaining: 23.1s
2:	learn: 0.5464283	total: 69.7ms	remaining: 23.2s
3:	learn: 0.5069459	total: 92.8ms	remaining: 23.1s
.
.
.
997:	learn: 0.1565486	total: 21.3s	remaining: 42.8ms
998:	learn: 0.1565066	total: 21.4s	remaining: 21.4ms
999:	learn: 0.1564972	total: 21.4s	remaining: 0us
í›ˆë ¨ ì •í™•ë„ 0.9413073922176654
ê²€ì¦ ì •í™•ë„ 0.9176753025907772
Report 
               precision    recall  f1-score   support

           0       0.92      0.96      0.94      6556
           1       0.92      0.84      0.88      3441

    accuracy                           0.92      9997
   macro avg       0.92      0.90      0.91      9997
weighted avg       0.92      0.92      0.92      9997

f1 ìŠ¤ì½”ì–´ 0.875094855061466
aucì ìˆ˜ :  0.898708424715136
'''
```

- RandomForestë¥¼ ì‚¬ìš©í–ˆì„ ë•Œë³´ë‹¤ ì•„ì£¼ ì¡°ê¸ˆ ì˜¬ëë‹¤.
- Thresholdë¥¼ ì„¤ì •í•œë‹¤.

```py
# roc_curve(íƒ€ê²Ÿê°’, prob of 1)
y_pred_proba = model.predict_proba(X_val)[:, 1]
fpr, tpr, thresholds = roc_curve(y_val, y_pred_proba)

roc = pd.DataFrame({
    'FPR(Fall-out)': fpr, 
    'TPRate(Recall)': tpr, 
    'Threshold': thresholds
})
# print(roc)

# roc ì‹œê°í™”
plt.rcParams["figure.figsize"] = (10,4)
plt.subplot(121)
plt.scatter(fpr, tpr)
plt.title('ROC curve')
plt.xlabel('FPR(Fall-out)')
plt.ylabel('TPR(Recall)');

# ìµœì ì˜ threshold
optimal_idx = np.argmax(tpr - fpr)
optimal_threshold = thresholds[optimal_idx]
print('idx:', optimal_idx, ', threshold:', optimal_threshold)

# auc ì‹œê°í™”
plt.subplot(122)
plt.plot(tpr-fpr);

# threshold ì„¤ì • ë° ë ˆí¬íŠ¸
y_pred_optimal = y_pred_proba >= optimal_threshold
print('Report \n',classification_report(y_val, y_pred_optimal))

# auc ì ìˆ˜
auc_score = roc_auc_score(y_val, y_pred_optimal)
print('ìµœì¢… ê²€ì¦ ì •í™•ë„: ', accuracy_score(y_val, y_pred_optimal))
print('ìµœì¢… f1 ìŠ¤ì½”ì–´',f1_score(y_val, y_pred_optimal))
print('ìµœì¢… aucì ìˆ˜ : ', auc_score)
'''
idx: 512 , threshold: 0.3877775976225708
Report 
               precision    recall  f1-score   support

           0       0.93      0.94      0.94      6556
           1       0.88      0.87      0.88      3441

    accuracy                           0.92      9997
   macro avg       0.91      0.91      0.91      9997
weighted avg       0.92      0.92      0.92      9997


ìµœì¢… ê²€ì¦ ì •í™•ë„:  0.9161748524557367
ìµœì¢… f1 ìŠ¤ì½”ì–´ 0.8775927548933684
ìµœì¢… aucì ìˆ˜ :  0.9059183447849827
'''
```

- ì„±ëŠ¥ì´ ì¡°ê¸ˆ ë” ì˜¬ëë‹¤.

![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2021-09-01 00 05 57](https://user-images.githubusercontent.com/79494088/131527618-76d32f92-79c5-41d3-9811-a6d645de06c6.png)

## Hyperparameters tuning

- Data imbalinceì— ì‚¬ìš©í•˜ëŠ” `scale_pos_weigt` ë° ì—¬ëŸ¬ê°€ì§€ Hyperparameters tuningì„ ì§„í–‰í•œë‹¤.

```py
model = CatBoostClassifier(scale_pos_weight = ratio, learning_rate = 0.1, max_depth = 10, n_estimators = 200)

model.fit(X_train, y_train)
y_pred = model.predict(X_val)

# roc_curve(íƒ€ê²Ÿê°’, prob of 1)
y_pred_proba = model.predict_proba(X_val)[:, 1]
fpr, tpr, thresholds = roc_curve(y_val, y_pred_proba)

roc = pd.DataFrame({
    'FPR(Fall-out)': fpr, 
    'TPRate(Recall)': tpr, 
    'Threshold': thresholds
})
# print(roc)

# roc ì‹œê°í™”
plt.rcParams["figure.figsize"] = (10,4)
plt.subplot(121)
plt.scatter(fpr, tpr)
plt.title('ROC curve')
plt.xlabel('FPR(Fall-out)')
plt.ylabel('TPR(Recall)');

# ìµœì ì˜ threshold
optimal_idx = np.argmax(tpr - fpr)
optimal_threshold = thresholds[optimal_idx]
print('idx:', optimal_idx, ', threshold:', optimal_threshold)

# auc ì‹œê°í™”
plt.subplot(122)
plt.plot(tpr-fpr);

# threshold ì„¤ì • ë° ë ˆí¬íŠ¸
y_pred_optimal = y_pred_proba >= optimal_threshold
print('Report \n',classification_report(y_val, y_pred_optimal))

# auc ì ìˆ˜
auc_score = roc_auc_score(y_val, y_pred_optimal)
print('ìµœì¢… ê²€ì¦ ì •í™•ë„: ', accuracy_score(y_val, y_pred_optimal))
print('ìµœì¢… f1 ìŠ¤ì½”ì–´',f1_score(y_val, y_pred_optimal))
print('ìµœì¢… aucì ìˆ˜ : ', auc_score)
'''
idx: 978 , threshold: 0.3913897995892618
Report 
               precision    recall  f1-score   support

           0       0.95      0.91      0.93     10244
           1       0.84      0.90      0.87      5377

    accuracy                           0.91     15621
   macro avg       0.90      0.91      0.90     15621
weighted avg       0.91      0.91      0.91     15621

ìµœì¢… ê²€ì¦ ì •í™•ë„:  0.9087126304333909
ìµœì¢… f1 ìŠ¤ì½”ì–´ 0.8719468390804599
ìµœì¢… aucì ìˆ˜ :  0.907336532588475
'''
```

- ì„±ëŠ¥ì´ ì•½ê°„ ë” ì¢‹ì•„ì¡Œë‹¤.

### GridSearchCV

- ìµœì ì˜ parameters ê°’ì„ ì°¾ê¸° ìœ„í•´ GridSerchCVë¥¼ ì§„í–‰í•œë‹¤.

```py
params ={
    'n_estimators': [100, 200, 300],
    'max_depth':[9, 10, 11],
    'learning_rate':[0.1, 0.2, 0.3]
}

cb = CatBoostClassifier(scale_pos_weight = ratio)
grid_cv = GridSearchCV(cb, param_grid=params, n_jobs=-1)
grid_cv.fit(X_train, y_train)
print('best parameters : \n', grid_cv.best_params_)
'''
best parameters : 
 {'learning_rate': 0.1, 'max_depth': 9, 'n_estimators': 200}
'''


# Best parameters ì ìš© Modeling
model = CatBoostClassifier(scale_pos_weight = ratio, learning_rate = 0.1, max_depth = 9, n_estimators = 200)

model.fit(X_train, y_train)
y_pred = model.predict(X_val)

# roc_curve(íƒ€ê²Ÿê°’, prob of 1)
y_pred_proba = model.predict_proba(X_val)[:, 1]
fpr, tpr, thresholds = roc_curve(y_val, y_pred_proba)

roc = pd.DataFrame({
    'FPR(Fall-out)': fpr, 
    'TPRate(Recall)': tpr, 
    'Threshold': thresholds
})
# print(roc)

# roc ì‹œê°í™”
plt.rcParams["figure.figsize"] = (10,4)
plt.subplot(121)
plt.scatter(fpr, tpr)
plt.title('ROC curve')
plt.xlabel('FPR(Fall-out)')
plt.ylabel('TPR(Recall)');

# ìµœì ì˜ threshold
optimal_idx = np.argmax(tpr - fpr)
optimal_threshold = thresholds[optimal_idx]
print('idx:', optimal_idx, ', threshold:', optimal_threshold)

# auc ì‹œê°í™”
plt.subplot(122)
plt.plot(tpr-fpr);

# threshold ì„¤ì • ë° ë ˆí¬íŠ¸
y_pred_optimal = y_pred_proba >= optimal_threshold
print('Report \n',classification_report(y_val, y_pred_optimal))

# auc ì ìˆ˜
auc_score = roc_auc_score(y_val, y_pred_optimal)
print('ìµœì¢… ê²€ì¦ ì •í™•ë„: ', accuracy_score(y_val, y_pred_optimal))
print('ìµœì¢… f1 ìŠ¤ì½”ì–´',f1_score(y_val, y_pred_optimal))
print('ìµœì¢… aucì ìˆ˜ : ', auc_score)
'''
idx: 898 , threshold: 0.45687398247139754
Report 
               precision    recall  f1-score   support

           0       0.94      0.93      0.93     10244
           1       0.86      0.89      0.88      5377

    accuracy                           0.91     15621
   macro avg       0.90      0.91      0.90     15621
weighted avg       0.91      0.91      0.91     15621

ìµœì¢… ê²€ì¦ ì •í™•ë„:  0.9133218103834582
ìµœì¢… f1 ìŠ¤ì½”ì–´ 0.8758936755270396
ìµœì¢… aucì ìˆ˜ :  0.907448955909144
'''
```

- ì„±ëŠ¥ì´ ì•„ì£¼ ì¡°ê¸ˆ ì˜¬ëë‹¤.

![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2021-09-01 00 20 18](https://user-images.githubusercontent.com/79494088/131530062-72bd5480-d6dc-4377-8259-b12f78cb29ed.png)

### ìµœì¢… Modeling
- ìˆ˜ë™ìœ¼ë¡œ ì¡°ì •í•œ Hyperparameters ê°’ì´ ê°€ì¥ ì¢‹ì€ ì„±ëŠ¥ì„ ë‚˜íƒ€ë‚´ì–´ ìµœì¢… Modelingì„ ì§„í–‰í–ˆë‹¤.

```py
# ìµœì¢… Modeling
model = CatBoostClassifier(scale_pos_weight = ratio, learning_rate = 0.1, max_depth = 10, n_estimators = 300)

model.fit(X_train, y_train)
y_pred = model.predict(X_val)

# roc_curve(íƒ€ê²Ÿê°’, prob of 1)
y_pred_proba = model.predict_proba(X_val)[:, 1]
fpr, tpr, thresholds = roc_curve(y_val, y_pred_proba)

roc = pd.DataFrame({
    'FPR(Fall-out)': fpr, 
    'TPRate(Recall)': tpr, 
    'Threshold': thresholds
})
# print(roc)

# roc ì‹œê°í™”
plt.rcParams["figure.figsize"] = (10,4)
plt.subplot(121)
plt.scatter(fpr, tpr)
plt.title('ROC curve')
plt.xlabel('FPR(Fall-out)')
plt.ylabel('TPR(Recall)');

# ìµœì ì˜ threshold
optimal_idx = np.argmax(tpr - fpr)
optimal_threshold = thresholds[optimal_idx]
print('idx:', optimal_idx, ', threshold:', optimal_threshold)

# auc ì‹œê°í™”
plt.subplot(122)
plt.plot(tpr-fpr);

# threshold ì„¤ì • ë° ë ˆí¬íŠ¸
y_pred_optimal = y_pred_proba >= optimal_threshold
print('Report \n',classification_report(y_val, y_pred_optimal))

# auc ì ìˆ˜
auc_score = roc_auc_score(y_val, y_pred_optimal)
print('ìµœì¢… ê²€ì¦ ì •í™•ë„: ', accuracy_score(y_val, y_pred_optimal))
print('ìµœì¢… f1 ìŠ¤ì½”ì–´',f1_score(y_val, y_pred_optimal))
print('ìµœì¢… aucì ìˆ˜ : ', auc_score)
'''
idx: 896 , threshold: 0.38973459361256957
Report 
               precision    recall  f1-score   support

           0       0.95      0.91      0.93     10244
           1       0.85      0.90      0.87      5377

    accuracy                           0.91     15621
   macro avg       0.90      0.91      0.90     15621
weighted avg       0.91      0.91      0.91     15621

ìµœì¢… ê²€ì¦ ì •í™•ë„:  0.9096728762563216
ìµœì¢… f1 ìŠ¤ì½”ì–´ 0.8728026683494096
ìµœì¢… aucì ìˆ˜ :  0.9074501541229775
'''
```

![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2021-09-01 00 24 01](https://user-images.githubusercontent.com/79494088/131530668-f5ab3dfe-22bc-45b0-b821-bd1059047061.png)

```py
# í…ŒìŠ¤íŠ¸ ë°ì´í„° ì„±ëŠ¥í™•ì¸
y_pred = model.predict(X_test)

# roc_curve(íƒ€ê²Ÿê°’, prob of 1)
y_pred_proba = model.predict_proba(X_test)[:, 1]
fpr, tpr, thresholds = roc_curve(y_test, y_pred_proba)

roc = pd.DataFrame({
    'FPR(Fall-out)': fpr, 
    'TPRate(Recall)': tpr, 
    'Threshold': thresholds
})

# roc ì‹œê°í™”
plt.rcParams["figure.figsize"] = (10,4)
plt.subplot(121)
plt.scatter(fpr, tpr)
plt.title('ROC curve')
plt.xlabel('FPR(Fall-out)')
plt.ylabel('TPR(Recall)');

# ìµœì ì˜ threshold
optimal_idx = np.argmax(tpr - fpr)
optimal_threshold = thresholds[optimal_idx]
print('idx:', optimal_idx, ', threshold:', optimal_threshold)

# auc ì‹œê°í™”
plt.subplot(122)
plt.plot(tpr-fpr);

# threshold ì„¤ì • ë° ë ˆí¬íŠ¸
y_pred_optimal = y_pred_proba >= optimal_threshold
print('Report \n',classification_report(y_test, y_pred_optimal))

# auc ì ìˆ˜
auc_score = roc_auc_score(y_test, y_pred_optimal)
print('í…ŒìŠ¤íŠ¸ ì •í™•ë„', model.score(X_test, y_test))
print('f1 ìŠ¤ì½”ì–´',f1_score(y_test, y_pred_optimal))
print('aucì ìˆ˜ : ', auc_score)
'''
idx: 1072 , threshold: 0.46905030139281495
Report 
               precision    recall  f1-score   support

           0       0.94      0.93      0.93     12804
           1       0.87      0.89      0.88      6722

    accuracy                           0.91     19526
   macro avg       0.90      0.91      0.91     19526
weighted avg       0.92      0.91      0.91     19526

í…ŒìŠ¤íŠ¸ ì •í™•ë„ 0.9150363617740449
f1 ìŠ¤ì½”ì–´ 0.8772961058045555
aucì ìˆ˜ :  0.9082160941412145
'''
```

![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2021-09-01 00 27 37](https://user-images.githubusercontent.com/79494088/131531224-d9e51333-97a0-499e-bd3b-745e0801af9d.png)

- Test Setì—ì„œì˜ ê²°ê³¼ë„ ë§Œì¡±í•  ë§Œí¼ ë‚˜ì™”ë‹¤.
- Train Setì— ê³¼ì í•©ë˜ì§€ ì•Šê³  ì¼ë°˜í™”ê°€ ì˜ ëë‹¤ê³  ë³¼ ìˆ˜ ìˆë‹¤.
- ìµœì¢…ì ìœ¼ë¡œ 91.5%ì˜ ì •í™•ë„ë¡œ ì°©ë¥™ ì§€ì—°ì„ ì˜ˆì¸¡í•˜ëŠ” ë¨¸ì‹ ëŸ¬ë‹ ëª¨ë¸ì„ ë§Œë“¤ì—ˆë‹¤.

# 7ï¸âƒ£ í•´ì„

## Permutation Importance

```py
# Permutation Importance í™•ì¸
# permuter ì •ì˜
permuter = PermutationImportance(
    model, # model
    scoring='accuracy', # metric
    n_iter=5, # ë‹¤ë¥¸ random seedë¥¼ ì‚¬ìš©í•˜ì—¬ 5ë²ˆ ë°˜ë³µ
    random_state=2
)

# ì‹¤ì œë¡œ fit ì˜ë¯¸ë³´ë‹¤ ìŠ¤ì½”ì–´ ë‹¤ì‹œ ê³„ì‚°í•˜ëŠ” ì‘ì—…
permuter.fit(X_val, y_val);

feature_names = ntrain.columns.tolist()
pd.Series(permuter.feature_importances_, feature_names).sort_values()
'''
SCHEDULED_ARRIVAL     -0.000371
WHEELS_OFF            -0.000346
TAIL_NUMBER            0.000090
SCHEDULED_DEPARTURE    0.000128
DEPARTURE_TIME         0.000755
ORIGIN_AIRPORT         0.003252
DESTINATION_AIRPORT    0.006120
AIRLINE                0.007016
DISTANCE               0.014506
SCHEDULED_TIME         0.026208
TAXI_OUT               0.064196
DEPARTURE_DELAY        0.317637
dtype: float64
'''

# íŠ¹ì„±ë³„ score í™•ì¸
eli5.show_weights(
    permuter, 
    top=None, # top n ì§€ì • ê°€ëŠ¥, None ì¼ ê²½ìš° ëª¨ë“  íŠ¹ì„± 
    feature_names=feature_names # list í˜•ì‹ìœ¼ë¡œ ë„£ì–´ì•¼ í•©ë‹ˆë‹¤
)
```

![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2021-09-01 01 04 53](https://user-images.githubusercontent.com/79494088/131537327-cbc37158-e187-4901-92f6-270305312c7c.png)

### ê°€ì„¤3 : ì¶œë°œ ì˜ˆì •ì‹œê°„ë³´ë‹¤ ì¶œë°œì— ì§€ì—°ëœ ì‹œê°„ì´ í´ ìˆ˜ë¡ ì°©ë¥™ ì§€ì—° í™•ë¥ ì€ ëŠ˜ì–´ë‚  ê²ƒì´ë‹¤.
- ì´ ì¶œë°œ ì§€ì—° ì‹œê°„ì´ ê°€ì¥ Modelì— í° ì˜í–¥ì„ ë¼ì¹œ ê±¸ ë³¼ ìˆ˜ ìˆë‹¤.
- ë‹¤ìŒìœ¼ë¡œ ê²Œì´íŠ¸ì—ì„œ í•­ê³µê¸°ê°€ ì´ë¥™í•  ë•Œê¹Œì§€ ê²½ê³¼ ì‹œê°„ë„ ë„ì°© ì§€ì—°ì— í° ì˜í–¥ì„ ë¯¸ì³¤ë‹¤.
- ê³„íšë˜ì–´ìˆëŠ” ë¹„í–‰ì‹œê°„ê³¼ ê±°ë¦¬ë„ ë¬´ì‹œ ëª»í• ë§Œí¼ì˜ ì˜í–¥ì„ ë¯¸ì³¤ë‹¤.

## PDP
- Permutation Importanceì—ì„œ ì˜í–¥ì„ ë§ì´ ë¼ì¹œ 4ê°€ì§€ Featureì— ëŒ€í•´ PDPlot í™•ì¸

```py
# í™”ì§ˆ
plt.rcParams['figure.dpi'] = 144

for i in ['DEPARTURE_DELAY', 'TAXI_OUT', 'SCHEDULED_TIME', 'DISTANCE']:
    feature = i
    isolated = pdp_isolate(
        model=model, 
        dataset=ntrain, 
        model_features=ntrain.columns, 
        feature=feature,
        grid_type='percentile', # default='percentile', or 'equal'
        num_grid_points=10 # default=10
    )
    pdp_plot(isolated, feature_name=feature);
```

![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2021-09-01 01 17 51](https://user-images.githubusercontent.com/79494088/131539180-4597c7ab-b618-4860-91d8-d04c2f60fdf9.png)

![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2021-09-01 01 18 13](https://user-images.githubusercontent.com/79494088/131539249-5975a635-e8dc-4da0-b3b5-e11c6442d921.png)

- `SCHEDULED_TIME`ê°€ ìŒì˜ ìƒê´€ê³„ìˆ˜ì¸ ê²ƒì„ ì œì™¸í•˜ë©´ ë‚˜ë¨¸ì§€ëŠ” ëª¨ë‘ ì–‘ì˜ ìƒê´€ê³„ìˆ˜ë¥¼ ë³´ì¸ë‹¤.

## SHAP

- SHAPì„ í†µí•´ ê° Featureì˜ ì˜í–¥ë ¥ í™•ì¸

```py
row = ntrain.iloc[[1]]  # ì¤‘ì²© bracketsì„ ì‚¬ìš©í•˜ë©´ ê²°ê³¼ë¬¼ì´ DataFrame
shap.initjs()
explainer = shap.TreeExplainer(model)
shap_values = explainer.shap_values(ntrain.iloc[:100])
shap.force_plot(explainer.expected_value, shap_values, ntrain.iloc[:100])
```

![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2021-09-01 01 33 42](https://user-images.githubusercontent.com/79494088/131541496-8f36bc59-a3a7-42f8-aa32-43f87fe66c78.png)

```py
shap.summary_plot(shap_values, ntrain.iloc[:300], plot_type="violin")
```

![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2021-09-01 01 34 03](https://user-images.githubusercontent.com/79494088/131541539-213d0f18-dc60-49e1-a811-484f4d6a48b3.png)

```py
# type ber
shap.summary_plot(shap_values, ntrain.iloc[:300], plot_type="bar")
```

![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2021-09-01 01 36 18](https://user-images.githubusercontent.com/79494088/131541800-85ecfc23-bc0c-4e97-a571-cf6f44ed1bf2.png)

- ê° ê·¸ë˜í”„ í™•ì¸ ê²°ê³¼ Permutation importanceì™€ ë§ˆì°¬ê°€ì§€ë¡œ Departure delayì˜ ì˜í–¥ë ¥ì´ ê°€ì¥ í¬ê³  ë‹¤ìŒìœ¼ë¡œ taxi out, distanceì¸ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.

- í˜„ì¬ Costì˜ í•œê³„ ë•Œë¬¸ì— 10ë§Œê°œì˜ Dataë§Œ ì‚¬ìš©í–ˆìŒì—ë„ ì°©ë¥™ ì§€ì—°ì— ê´€í•œ ì¢‹ì€ ì„±ëŠ¥ì˜ Modelingì„ í–ˆë‹¤.
- ëª¨ë“  Dataë¥¼ í™œìš©í•œë‹¤ë©´ ë” ì¢‹ì€ ì„±ëŠ¥ì„ ì´ëŒì–´ ë‚¼ ìˆ˜ ìˆì„ ê±°ë¼ ìƒê°í•˜ê³ , ê·¸ë ‡ê²Œ ëœë‹¤ë©´ Date ì •ë³´ë„ ì˜ˆì¸¡ì— í™œìš© ë  ìˆ˜ ìˆë‹¤.
- ë˜í•œ í˜„ì¬ ì°©ë¥™ ì§€ì—°ì— ëŒ€í•œ ì˜ˆì¸¡ì„ í•  ìˆ˜ ë°–ì— ì—†ëŠ” íŠ¹ì„±ë“¤ì´ì—ˆëŠ”ë°, ê¸°ìƒ ë°ì´í„°ì™€ í•­ê³µ ì •ë¹„ ì´ë ¥ì— ê´€í•œ íŠ¹ì„±ì´ ì£¼ì–´ì§„ë‹¤ë©´ ì´ë¥™ ì§€ì—°ì— ëŒ€í•œ ì˜ˆì¸¡ì´ ê°€ëŠ¥í•´ì ¸ ì†Œë¹„ì í˜¹ì€ ê³µí•­ì´ë‚˜ í•­ê³µì‚¬ì˜ íš¨ìœ¨ì„±ê³¼ ë¹„ìš©ì ˆê°ì— ë”ìš± í¬ê²Œ ê¸°ì—¬í•  ìˆ˜ ìˆì„ ê±°ë¼ê³  ìƒê°í•œë‹¤.