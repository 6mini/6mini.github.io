---
title: '[MongoDB] Python Pymongo handling exemple'
description: íŒŒì´ì¬ì—ì„œ Pymongoë¥¼ í™œìš©í•˜ì—¬ MongoDBë¥¼ ë‹¤ë£¨ëŠ” ì—¬ëŸ¬ê°€ì§€ ë°©ë²• ì˜ˆì œ
categories:
 - Did Unknown
tags: [Did Unknown, Python, Pymongo, MongoDB, NoSQL]
mathjax: enable
# 0ï¸âƒ£1ï¸âƒ£2ï¸âƒ£3ï¸âƒ£4ï¸âƒ£5ï¸âƒ£6ï¸âƒ£7ï¸âƒ£8ï¸âƒ£9ï¸âƒ£ğŸ”Ÿ
---

# 1ï¸âƒ£ MongoDB Setup
- MongoDB ì—°ê²°

```py
from pymongo import MongoClient

HOST = ''
USER = ''
PASSWORD = ''
DATABASE_NAME = ''
MONGO_URI = f"mongodb+srv://{USER}:{PASSWORD}@{HOST}/{DATABASE_NAME}?retryWrites=true&w=majority"
```

# 2ï¸âƒ£ Data insert

## insert_one
- í•˜ë‚˜ì˜ ë„íë¨¼íŠ¸ insert(Openweather API)

```py
openweather = {
  "coord": {
    "lon": -122.08,
    "lat": 37.39
  },
  "weather": [
    {
      "id": 800,
      "main": "Clear",
      "description": "clear sky",
      "icon": "01d"
    }
  ],
  "base": "stations",
  "main": {
    "temp": 282.55,
    "feels_like": 281.86,
    "temp_min": 280.37,
    "temp_max": 284.26,
    "pressure": 1023,
    "humidity": 100
  },
  "visibility": 16093,
  "wind": {
    "speed": 1.5,
    "deg": 350
  },
  "clouds": {
    "all": 1
  },
  "dt": 1560350645,
  "sys": {
    "type": 1,
    "id": 5122,
    "message": 0.0139,
    "country": "US",
    "sunrise": 1560343627,
    "sunset": 1560396563
  },
  "timezone": -25200,
  "id": 420006353,
  "name": "Mountain View",
  "cod": 200
  }

COLLECTION_NAME = 'openweather'
coll = MongoClient(MONGO_URI)[DATABASE_NAME][COLLECTION_NAME] # ì»¬ë ‰ì…˜ ì—°ê²°

coll.insert_one(document=openweather)
print(coll.find_one()) # í•˜ë‚˜ì˜ ë„íë¨¼íŠ¸
'''
{
   "_id":"ObjectId(""614d496f7abb8d643cf3dc82"")",
   "coord":{
      "lon":-122.08,
      "lat":37.39
   },
   "weather":[
      {
         "id":800,
         "main":"Clear",
         "description":"clear sky",
         "icon":"01d"
      }
   ],
   "base":"stations",
   "main":{
      "temp":282.55,
      "feels_like":281.86,
      "temp_min":280.37,
      "temp_max":284.26,
      "pressure":1023,
      "humidity":100
   },
   "visibility":16093,
   "wind":{
      "speed":1.5,
      "deg":350
   },
   "clouds":{
      "all":1
   },
   "dt":1560350645,
   "sys":{
      "type":1,
      "id":5122,
      "message":0.0139,
      "country":"US",
      "sunrise":1560343627,
      "sunset":1560396563
   },
   "timezone":-25200,
   "id":420006353,
   "name":"Mountain View",
   "cod":200
}
'''
```

## insert_many
- Github API ì´ìš© ì—¬ëŸ¬ê°€ì§€ ë°ì´í„° insert

```py
import time
import requests

sixmini = ''
response = requests.get("https://api.github.com/users/6mini/repos")
time.sleep(1) # github APIëŠ” í˜¸ì¶œì´ ë§ì´ ë°œìƒí•˜ë©´ ìì²´ì ìœ¼ë¡œ ì œí•œì„ ê±¸ ìˆ˜ ìˆì–´ì„œ í•œë²ˆì˜ API í˜¸ì¶œ í›„ 1ì´ˆ sleep ì‹œê°„ì„ ì§€ì •

if response.status_code == 200:
    sixmini = response.json() # í˜¸ì¶œëœ API ì¶”ê°€

COLLECTION_NAME = '6mini_repos'
coll = MongoClient(MONGO_URI)[DATABASE_NAME][COLLECTION_NAME]

coll.insert_many(sixmini)
for repo in coll.find(): # ëª¨ë“  ë„íë¨¼íŠ¸ find í›„ forë¬¸ìœ¼ë¡œ repo name ì¶œë ¥
    print(repo['name'])
'''
6mini
6mini.github.io
AI_Fashion_Analyzer
github-stats-box
Naver_Movie_Scraper
productive-box
Project
Sixtest
TIL
'''
```

## insert CSV File
- íƒ€ì´íƒ€ë‹‰ CSV íŒŒì¼ì„ JSONí˜•íƒœë¡œ ë³€ê²½ í›„ insert

```py
import pandas as pd
import json

data = json.loads(pd.read_csv('titanic.csv').to_json(orient='records')) # csv data jsoní˜•íƒœë¡œ ë³€ê²½
COLLECTION_NAME = 'passengers'
coll = MongoClient(MONGO_URI)[DATABASE_NAME][COLLECTION_NAME]
coll.remove() # ë„íë¨¼íŠ¸ë¥¼ ë¹„ìš°ëŠ” ë©”ì†Œë“œ
coll.insert_many(data)
```

# 3ï¸âƒ£ MongoDB to SQLite
- ë°ì´í„° ì—”ì§€ë‹ˆì–´ì˜ ê²½ìš° ë°ì´í„° ìˆ˜ì§‘ì„ ë¹ ë¥´ê²Œ ì§„í–‰í•˜ê³ ì NoSQLë¡œ ìˆ˜ì§‘ì„ ì§„í–‰í•œ ë’¤, ëª¨ë¸ë§ì„ ê±°ì³ ë¶„ì„ì´ ê°€ëŠ¥í•˜ë„ë¡ ë°ì´í„°ì›¨ì–´í•˜ìš°ìŠ¤ í˜¹ì€ ë°ì´í„° ë§ˆíŠ¸ í˜•íƒœë¡œ ë°ì´í„°ë¥¼ ì „ë‹¬í•œë‹¤.

```py
import os
import sqlite3

prlist = ''
response = requests.get("https://api.github.com/repos/codestates/ds-sa-nosql-issues/issues")
time.sleep(1)

if response.status_code == 200:
    prlist = response.json()

COLLECTION_NAME = 'PR_LIST'
DB_FILENAME = 'PR_LIST_RDB.db'
DB_FILEPATH = os.path.join(os.getcwd(), DB_FILENAME)
coll = MongoClient(MONGO_URI)[DATABASE_NAME][COLLECTION_NAME]

coll.insert_many(prlist)

conn = sqlite3.connect(DB_FILEPATH)
cur = conn.cursor()

# ìŠ¤í‚¤ë§ˆ ìƒì„±
cur.execute("DROP TABLE IF EXISTS PRList;")
cur.execute("""CREATE TABLE PRList(
            id INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL,
            node_id VARCHAR(20),
            title VARCHAR(100),
            body VARCHAR(100),
            created_at VARCHAR(20),
            comments INTEGER,
            userId INTEGER,
            labelId INTEGER
            );""")

cur.execute("DROP TABLE IF EXISTS Label;")
cur.execute("""CREATE TABLE Label(
            id INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL,
            name VARCHAR(20),
            node_id VARCHAR(20),
            color VARCHAR(10),
            FOREIGN KEY(id) REFERENCES PRList(userId)
            );""")

cur.execute("DROP TABLE IF EXISTS User;")
cur.execute("""CREATE TABLE User(
            id INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL,
            login VARCHAR(10),
            node_id VARCHAR(20),
            FOREIGN KEY(id) REFERENCES PRList(labelId)
            );""")

conn.commit()

# forë¬¸ ì´ìš© ë°ì´í„° sqlite insert
for pr in coll.find():
    userId = pr['user']['id']
    labelId = pr['labels'][0]['id']

    cur.execute("""INSERT OR IGNORE INTO PRList (id, node_id, title, body, created_at, comments, userId, labelId) VALUES (?, ?, ?, ?, ?, ?, ?, ?);""", (pr['id'], pr['node_id'], pr['title'], pr['body'], pr['created_at'], pr['comments'], userId, labelId))

    cur.execute("""INSERT OR IGNORE INTO Label (id, name, node_id, color) VALUES (?, ?, ?, ?);""", (labelId, pr['labels'][0]['name'], pr['labels'][0]['node_id'], pr['labels'][0]['color']))

    cur.execute("""INSERT OR IGNORE INTO User (id, login, node_id) VALUES (?, ?, ?);""", (userId, pr['user']['login'], pr['user']['node_id']))

conn.commit()
```