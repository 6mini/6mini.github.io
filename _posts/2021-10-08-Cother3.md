---
title: '[Data Pipeline Project(2)] COVID-19 & Weather(3) Flask & Pickle'
description: 코드스테이츠 Section3(Data Engineering) Data Pipeline 구축 프로젝트 pkl 이용 Flask 앱에 머신러닝 모델 연동
categories:
 - Project
tags: [Project, Python, Flask, Pickle]
---

# PKL load test

```py
import pickle
import numpy as np
 
model = pickle.load(open("lgb.pkl", "rb"))

arr = np.array([[57.3,0.0,10.5,1018.2,2.3,4.8,8.5,18.4,2.5,0.0,13.3]])
pred = model.predict(arr)
print(pred)
'''
225
'''
```

# Flask

## 구성

```
CO-THER-19
ㄴ app.py
ㄴ static
  ㄴ css
  ㄴ img
  ㄴ js
ㄴ templates
  ㄴ index.html
  ㄴ 404.html
ㄴ data
  ㄴ pkl
ㄴ Procfile
ㄴ requirements.txt
```

## 머신러닝 연결 구현

### app.py
```py
from flask import Flask, render_template, request
import numpy as np
import pickle

app = Flask(__name__)
model = pickle.load(open("data/pkl/lgb.pkl", "rb"))

@app.errorhandler(404)
def page_not_found(error):
	return render_template('404.html'), 404

@app.route('/', methods=['GET', 'POST'])
def index():
    if request.method == 'GET':
        return render_template('index.html')

    if request.method == 'POST':
        try:
            data1 = float(request.form['avgRhm'])
            data2 = float(request.form['ddMes'])
            data3 = float(request.form['sumSsHr'])
            data4 = float(request.form['avgPs'])
            data5 = float(request.form['avgTca'])
            data6 = float(request.form['avgTd'])
            data7 = float(request.form['minTa'])
            data8 = float(request.form['maxTa'])
            data9 = float(request.form['avgWs'])
            data10 = float(request.form['sumRn'])
            data11 = float(request.form['avgTa'])

            arr = np.array([[data1, data2, data3, data4, data5, data6, data7, data8, data9, data10, data11]])
            pred = model.predict(arr)
            pred = round(pred[0])
            return render_template("index.html", pred=pred)
        except:
            return render_template("404-2.html")

if __name__ == "__main__":
    app.run(debug=True)
```

### html
- input과 button 구현

```html
<section>
    <div>
        <form action="/" method="post">
        <div class="information-name">
            <input type="text" name="avgTa" required>
            <label for="formGroupExampleInput">평균기온</label>
        </div>
        <div class="information-name">
            <input type="text" name="minTa" required>
            <label for="formGroupExampleInput">최저기온</label>
        </div>
        <div class="information-name">
            <input type="text" name="maxTa" required>
            <label for="formGroupExampleInput">최고기온</label>
        </div>
        <div class="information-name">
            <input type="text" name="avgRhm" required>
            <label for="formGroupExampleInput">습도</label>
        </div>
        <div class="information-name">
            <input type="text" name="avgWs" required>
            <label for="formGroupExampleInput">풍속</label>
        </div>
        <div class="information-name">
            <input type="text" name="sumRn" required>
            <label for="formGroupExampleInput">강수량</label>
        </div>
        <div class="information-name">
            <input type="text" name="ddMes" required>
            <label for="formGroupExampleInput">적설량</label>
        </div>
        <div class="information-name">
            <input type="text" name="avgTca" required>
            <label for="formGroupExampleInput">전운량</label>
        </div>
        <div class="information-name">
            <input type="text" name="sumSsHr" required>
            <label for="formGroupExampleInput">일조시간</label>
        </div>
        <div class="information-name">
            <input type="text" name="avgPs" required>
            <label for="formGroupExampleInput">해면기압</label>
        </div>
        <div class="information-name">
            <input type="text" name="avgTd" required>
            <label for="formGroupExampleInput">이슬점온도</label>
        </div>
        <button type="submit">Predict</button>
        </form>
    </div>
</section>
```

- POST 시 pred 표시 구현

```html
{% raw %}{% if pred %}
<h1>기상에 대한 서울시<br>예상 확진자 수: {{ pred }}명</h1>
{% endif %}{% endraw %}
```

# Flask run

```
$ export FLASK_ENV=development

$ export FLASK_APP=app.py

$ flask run
```

## Confirm

![image](https://user-images.githubusercontent.com/79494088/136700137-9b979337-4e5c-45cd-afbb-4c59f8bd0151.png)

![image](https://user-images.githubusercontent.com/79494088/136700160-1f888ea7-7abe-4c50-bdb0-a83edb2ce66c.png)
