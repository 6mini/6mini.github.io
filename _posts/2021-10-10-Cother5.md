---
title: '[Data Pipeline Project] COVID-19 & Weather(5) Crontab'
description: 코드스테이츠 Section3(Data Engineering) Data Pipeline 구축 프로젝트 AWS EC2 이용 Cronjob 생성 후 기상데이터 수집 자동화
categories:
 - Project
tags: [Project, Python, API, AWS, EC2, Crontab, Cronjob]
---

- [COTHER-19 Web Site 바로가기](https://cother.herokuapp.com/)
- [COTHER-19 GitHub Repository 바로가기](https://github.com/6mini/CO-THER-19)
- 전체 포스팅 목록
    - [[Data Pipeline Project] COVID-19 & Weather(1) API to AWS Postgres](https://6mini.github.io/project/2021/10/06/Cother/)
    - [[Data Pipeline Project] COVID-19 & Weather(2) LightGBM](https://6mini.github.io/project/2021/10/07/Cother2/)
    - [[Data Pipeline Project] COVID-19 & Weather(3) Flask & Pickle & Heroku](https://6mini.github.io/project/2021/10/08/Cother3/)
    - [[Data Pipeline Project] COVID-19 & Weather(4) Tableau](https://6mini.github.io/project/2021/10/09/Cother4/)
    - [[Data Pipeline Project] COVID-19 & Weather(5) Crontab](https://6mini.github.io/project/2021/10/10/Cother5/)
    - [[Data Pipeline Project] COVID-19 & Weather(6) Final & Retrospect](https://6mini.github.io/project/2021/10/11/Cother6/)

# API to Postgres 함수 수정
- 시작, 끝 날짜 Datetime으로 어제 날짜로 맞춰주기(기상 API는 전 날 날짜까지만 지원)

```py
yesterday = (datetime.today() - timedelta(1)).strftime("%Y%m%d")
startDate = yesterday
endDate = yesterday
```

# EC2 생성

![image](https://user-images.githubusercontent.com/79494088/136694308-e343f233-808a-4fe3-be34-b9a7bb3db264.png)

- pem file이 있는 곳에서 ssh 실행

```sh
$ ssh -i 6mini.pem ec2-user@ec2-3-38-108-111.ap-northeast-2.compute.amazonaws.com

$ sudo yum update
```

## CP 작업
- sever에 py파일 cp

```sh
$ scp -i 6mini.pem postgres-weather-cronjob.py ec2-user@ec2-3-38-108-111.ap-northeast-2.compute.amazonaws.com:~/
```

- install pip

```sh
$ curl -O https://bootstrap.pypa.io/get-pip.py

$ sudo python3 get-pip.py
```

- 필요한 module install 후 python3 실행 시 정상 작동

# Crontab
- install crontab 

```sh
$ sudo service crond start
```

- vim file 수정
- mailto로 메일로 받아보기

```sh
$ crontab -e
'''
MAILTO=real6mini@gmail.com 

30 18 * * * /usr/bin/python3 /home/ec2-user/postgres-weather-cronjob.py
'''
```

## confirm

```sh
'''
crontab: installing new crontab
'''

$ crontab -l
'''
MAILTO=real6mini@gmail.com

30 18 * * * /usr/bin/python3 /home/ec2-user/postgres-weather-cronjob.py
'''
```

- ec2는 utc시간대이기 때문에 잘 생각해서 해야한다.
- TEST는 메일이 오길 기다리자.