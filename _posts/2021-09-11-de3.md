---
title: 'SQL advanced'
description: SQL 다중 테이블 쿼리, 클라우드 데이터베이스와 연결, NoSQL에 대한 정의와 종류, 트랜잭션과 ACID, Group by 사용
categories:
 - Data Engineering
tags: [Data Engineering, SQL, Cloud DB, 다중 테이블 쿼리, NoSQL, 트랜잭션, ACID, Group by]
mathjax: enable
# 0️⃣1️⃣2️⃣3️⃣4️⃣5️⃣6️⃣7️⃣8️⃣9️⃣🔟
---

# 1️⃣ Reference
- **ACID**
  - [Atomicity Consistency Isolation Durability (ACID)](https://www.techopedia.com/definition/23949/atomicity-consistency-isolation-durability-acid-database-management-system)
  - [Manage MySQL Transactions in Python](https://pynative.com/python-mysql-transaction-management-using-commit-rollback/)

# 트랜잭션
- 트랜잭션 : 통상적으로 정보의 교환이나 데이터베이스 갱신 등 일련의 작업들에 대해 연속처리단위를 의미
  - DB의 무결성이 보장되는 상태에서 요청된 작업을 완수하기 위한 작업의 기본 단위로 간주
  - 간단히 **DB의 상태를 변화시키는 작업의 모음**
  - 주로 DB의 상태를 변화시키는 INSERT, DELETE, UPDATE 중 한개 이상의 DML(Data Manipulation Language)과 같이 사용
- 생활 속 예시

![스크린샷 2021-09-10 12 32 39](https://user-images.githubusercontent.com/79494088/132795270-d5a3bb28-3990-417d-967e-0f453a9bb452.png)

- 위 작업 중 어느 하나가 실패로 실행된다면 위의 전제는 실행되어선 안된다.

## COMMIT과 Rollback

```sql
CREATE TABLE user ( -- 테이블 생성
	id varchar(10) primary Key,
	name varchar(10)
);

INSERT INTO user VALUES ('id1', 'user1'); -- 값 insert
INSERT INTO user VALUES ('id2', 'user2');

COMMIT; -- commit을 하지 않으면 재가동 시 위의 값들 모두 reset

INSERT INTO user VALUES ('id3', 'user3');

ROLLBACK; -- commit을 잘못하면 수동적으로 rollback
```

- 트랜잭션 : 여러 개의 작업을 하나의 실행 유닛으로 묶어즌 것
- 각 트랜잭션은 하나의 특정 작업으로 시작해 묶여 있는 모든 작업을 다 완료해야 끝나게 되어있다.
- 만약 한 개의 작업이라도 실패하게 된다면 전부 실패한다.
- 작업이 하나라도 실패하면 트랜잭션도 실패이고 모든 작업이 성공적이면 트랜잭션 또한 성공적이게 된다.
- 트랜잭션은 미완료된 단계없이 전부를 성공해야 한다.
- 데이터베이스 트랜잭션의 정의는 ACID 특성을 가지고 있다.

# ACID 

## Atomicity(원자성)
- 하나의 트랜잭션을 구성하는 작업은 전부 성공하거나 전부 실패해야 된다.
- 부분적으로 실행되면 안된다.
- SQL에서 특정 쿼리를 실행했는데 부분적으로 실패하는 부분이 있다면 전부 실패하게 되어있다(충돌 요인에 대해 선택지를 제공한다).

## Consistency(일관성)
- 하나의 트랜잭션 이전과 이후 데이터베이스 상태는 이전과 같이 유효해야 한다.
- 데이터베이스의 제약이나 규칙에 의거한 데이터베이스여야 한다.
- if id와 name이 있는 user table에서 